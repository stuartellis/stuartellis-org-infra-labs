
plan_terraform:
  image: alpine:3.18.0
  stage: plan
  before_script:
    - apk add --no-cache curl git jq make unzip
  script:
    - make terraform-install
    - make terraform-init
    - make terraform-plan
  artifacts:
    when: on_success
    name: $PRODUCT_NAME-$STACK_NAME-$ENVIRONMENT-$STACK_VARIANT-tfplan
    expire_in: 1 week
    paths:
      - tmp/terraform
